<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3I/ATLAS Tracker</title>
<style>
  body {margin:0; overflow:hidden; font-family:sans-serif; background:#000010; color:#fff;}
  #status {position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.7); padding:5px 10px; border-radius:5px;}
  #controls {position:absolute; top:10px; right:10px; display:flex; gap:5px; flex-wrap:wrap;}
  #controls button {padding:6px 10px; font-size:14px; border-radius:5px; border:none; background:#00d4ff; color:#000; cursor:pointer;}
</style>
</head>
<body>
<div id="status">Initializing...</div>
<div id="controls">
  <button id="toggleView">Earth View: Off</button>
  <button id="toggleOrbit">Orbit: On</button>
</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.0/examples/js/controls/OrbitControls.js"></script>
<script>
let scene, camera, renderer, controls;
let sun, earth, interstellarObj, orbitLine;
let useEarthView = false;
let showOrbit = true;
let time = 0;
const AU = 150; // scale factor

// Simplified interstellar object data
const objectData = {
  atlas: {color:0x00d4ff, semiMajorAxis:-0.5, eccentricity:6.2, inclination:45*Math.PI/180, argumentOfPerihelion:215*Math.PI/180, longitudeOfNode:310*Math.PI/180}
};

init();
animate();

function init() {
  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 5000);
  camera.position.set(0, 200, 500);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  // Sun
  sun = new THREE.Mesh(new THREE.SphereGeometry(25,32,32), new THREE.MeshBasicMaterial({color:0xffff00}));
  scene.add(sun);

  // Earth
  earth = new THREE.Mesh(new THREE.SphereGeometry(6,32,32), new THREE.MeshPhongMaterial({color:0x2233ff}));
  earth.position.set(AU,0,0);
  scene.add(earth);

  // Interstellar Object
  interstellarObj = new THREE.Mesh(new THREE.SphereGeometry(5,16,16), new THREE.MeshBasicMaterial({color:objectData.atlas.color}));
  scene.add(interstellarObj);

  // Orbit line
  createOrbitLine();

  // Lighting
  scene.add(new THREE.AmbientLight(0x404040));
  scene.add(new THREE.PointLight(0xffffff,2,2000));

  // Starfield
  const starsGeo = new THREE.BufferGeometry();
  const starVertices = [];
  for(let i=0;i<1500;i++){
    starVertices.push((Math.random()-0.5)*5000,(Math.random()-0.5)*5000,(Math.random()-0.5)*5000);
  }
  starsGeo.setAttribute('position', new THREE.Float32BufferAttribute(starVertices,3));
  const stars = new THREE.Points(starsGeo,new THREE.PointsMaterial({color:0xffffff,size:1}));
  scene.add(stars);

  // Buttons
  document.getElementById('toggleView').addEventListener('click',()=>{
    useEarthView = !useEarthView;
    document.getElementById('toggleView').textContent = 'Earth View: '+(useEarthView?'On':'Off');
  });
  document.getElementById('toggleOrbit').addEventListener('click',()=>{
    showOrbit = !showOrbit;
    orbitLine.visible = showOrbit;
  });

  window.addEventListener('resize', onWindowResize);
  document.getElementById('status').textContent = 'Ready';
}

function createOrbitLine(){
  const points = [];
  for(let i=0;i<=360;i++){
    const t = i * Math.PI/180;
    const x = AU*2 * Math.cos(t);
    const z = AU*2 * Math.sin(t);
    points.push(new THREE.Vector3(x,0,z));
  }
  const geometry = new THREE.BufferGeometry().setFromPoints(points);
  const material = new THREE.LineBasicMaterial({color:0x00d4ff});
  orbitLine = new THREE.Line(geometry,material);
  scene.add(orbitLine);
}

function calculateHyperbolicPosition(t){
  const data = objectData.atlas;
  const a = data.semiMajorAxis * AU;
  const e = data.eccentricity;
  const F = t;
  const r = Math.abs(a)*(e*Math.cosh(F)-1);
  const v = 2 * Math.atan(Math.sqrt((e+1)/(e-1))*Math.tanh(F/2));
  const xOrb = r*Math.cos(v);
  const yOrb = r*Math.sin(v);
  const i = data.inclination, w=data.argumentOfPerihelion, o=data.longitudeOfNode;
  const x = (Math.cos(o)*Math.cos(w)-Math.sin(o)*Math.sin(w)*Math.cos(i))*xOrb + (-Math.cos(o)*Math.sin(w)-Math.sin(o)*Math.cos(w)*Math.cos(i))*yOrb;
  const y = (Math.sin(w)*Math.sin(i))*xOrb + (Math.cos(w)*Math.sin(i))*yOrb;
  const z = (Math.sin(o)*Math.cos(w)+Math.cos(o)*Math.sin(w)*Math.cos(i))*xOrb + (-Math.sin(o)*Math.sin(w)+Math.cos(o)*Math.cos(w)*Math.cos(i))*yOrb;
  return new THREE.Vector3(x,y,z);
}

function animate(){
  requestAnimationFrame(animate);
  controls.update();
  time += 0.01;

  interstellarObj.position.copy(calculateHyperbolicPosition(time*5));

  // Earth portal view
  if(useEarthView){
    const offset = new THREE.Vector3(0,30,80);
    camera.position.copy(earth.position.clone().add(offset));
    camera.lookAt(interstellarObj.position);
  }

  renderer.render(scene,camera);
}

function onWindowResize(){
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}
</script>
</body>
</html>
